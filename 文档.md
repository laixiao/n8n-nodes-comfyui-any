在本地修改了 **n8n-nodes-comfyui-any** 的源码后，要让 n8n 识别并安装你的本地自定义节点，有 **两种常用方式**：`本地开发模式` 和 `打包成 npm 模块安装`。下面按最稳妥、最常用的方式给你完整步骤。

---

# ✅ 方法一：直接把源码放进 n8n 的本地 custom-nodes 目录（最简单）

> 适合快速调试、自己使用。
> **不需要 npm publish，不需要打包。**

### 1. 找到 n8n 的自定义节点目录

不同部署方式路径不同：

### **如果你用 Docker：**

先进入容器：

```bash
docker exec -it n8n bash
```

进入目录：

```bash
cd /home/node/.n8n/custom
```

⚠️如果没有可以自己建：

```bash
mkdir -p /home/node/.n8n/custom
```

---

### 2. 将你的修改后的源码放进去

例如：

```
/home/node/.n8n/custom/n8n-nodes-comfyui-any/
```

文件结构必须包含：

```
package.json
dist/
nodes/
credentials/
```

（如果你是 TypeScript 源码，记得要先编译出 dist）

---

### 3. 安装依赖

进入你的节点目录：

```bash
cd /home/node/.n8n/custom/n8n-nodes-comfyui-any
npm install
```

---

### 4. 重启 n8n

Docker：

```bash
docker restart n8n
```

本地运行：

```bash
n8n stop
n8n start
```

---

### 5. n8n 会自动加载你的节点

打开 n8n → 搜索节点名称
你修改后的版本就会出现。

---

# ✅ 方法二：将源码打包成 npm 本地包，然后用 npm 安装

适合你想保持目录干净或多个项目共用。

### 1. 在你的修改源码目录执行：

```bash
npm pack
```

会生成一个：

```
n8n-nodes-comfyui-any-1.0.0.tgz
```

---

### 2. 把 tgz 拷贝到 n8n custom 目录

Docker 示例：

```bash
docker cp n8n-nodes-comfyui-any-1.0.0.tgz n8n:/home/node/.n8n/custom/
docker exec -it n8n bash
cd /home/node/.n8n/custom
npm install ./n8n-nodes-comfyui-any-1.0.0.tgz
```

---

### 3. 重启 n8n

```bash
docker restart n8n
```

---

# ⚠️ 重要注意事项

### ✔ 你的 package.json 必须包含：

```json
{
  "name": "n8n-nodes-comfyui-any",
  "version": "1.0.0",
  "n8n": {
    "nodes": ["dist/nodes/ComfyuiAny.node.js"],
    "credentials": ["dist/credentials/ComfyuiAny.credentials.js"]
  }
}
```

### ✔ 如果你是 TS，需要编译：

```bash
npm run build
```

确保 dist/ 文件夹内都是 js。

### ✔ Docker 编译困难？可以在本地编译好 dist 再复制进去。

